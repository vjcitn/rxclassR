---
title: "rxclassR: use the NIH rxclass API for drug classification"
author: "Vincent J. Carey, stvjc at channing.harvard.edu"
date: "`r format(Sys.time(), '%B %d, %Y')`"
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{rxclassR: use the NIH rxclass API for drug classification}
  %\VignetteEncoding{UTF-8}
output:
  html_document:
    highlight: pygments
    number_sections: yes
    theme: united
    toc: yes
---

# Introduction

We will use the API at `https://rxnav.nlm.nih.gov/REST/rxclass` as
defined in early 2026 to simplify classification of drugs.

We will assume that an `rxcui` identifier is available for any drug of interest.

This package is not designed to do large scale interrogation of the API,
which might lead to banning the host IP address for overuse.  Any loops
should include sleep directives.

# Obtaining classification codes

The endpoint `rxclass/class/byRxcui` is very inclusive and will
return information on multiple related compounds.  The `filter`
argument forces focus on the compound rxcui supplied.

```{r do1, message=FALSE}
library(rxclassR)
getclass(1364447, filter=TRUE)
```

# Learning about the hierarchy of a given class

Here we assume the argument is a potential class code known
to the rxclass API.

```{r do2}
getpath("B01AF")
```

# Configurations of treatments

The `make_upset` function shows the most common
classes and combinations seen in the cohort.

```{r cont}
suppressWarnings(example(make_upset, ask=FALSE))
```

Note that the diagram depends on the selection of
the 'depth' in the summ function.

```{r dode}
 thes = lapply(allcls, summ, 2)
 for (i in seq_len(length(allcls))) thes[[i]]$id = i
 ddf = do.call(rbind, thes)
 suppressWarnings(make_upset(ddf))
```


